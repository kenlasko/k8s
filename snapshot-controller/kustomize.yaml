apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
metadata:
  name: snapshot-controller
namespace: kube-system
patches:
- target:
    kind: Deployment
    name: snapshot-controller
  patch: |-
    - op: add
      path: /spec/template/spec/affinity
      value: |
        nodeAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: node-role.kubernetes.io/control-plane
                operator: DoesNotExist
              - key: kubernetes.io/arch
                operator: In
                values: 
                - 'amd64'