rollOutCiliumPods: true
# routingMode: native             # Original
routingMode: tunnel               # New
tunnelProtocol: geneve            # New
ipv4NativeRoutingCIDR: 10.0.0.0/9
# autoDirectNodeRoutes: true      # Original
# tunnel: disabled                # Original
bpf:
  hostRouting: true
  masquerade: true
ipam:
  mode: kubernetes
cluster:
  name: home
  id: 0
loadBalancer:                     # New
  mode: dsr                       # New
  dsrDispatch: geneve             # New
l2announcements:
  enabled: true
  leaseDuration: 6s
  leaseRenewDeadline: 2s
  leaseRetryPeriod: 200ms
envoy:
  enabled: true
  rollOutPods: true
externalIPs:
  enabled: true
extraEnv:
- name: TZ
  value: "America/Toronto"
kubeProxyReplacement: true
k8sServiceHost: localhost
k8sServicePort: 6444  # Needs to be 7445 for Talos
## This is for Talos
# securityContext:
#   capabilities:
#     ciliumAgent: 
#     - CHOWN
#     - KILL
#     - NET_ADMIN
#     - NET_RAW 
#     - IPC_LOCK
#     - SYS_ADMIN
#     - SYS_RESOURCE
#     - DAC_OVERRIDE
#     - FOWNER
#     - SETGID
#     - SETUID
#     cleanCiliumState: 
#     - NET_ADMIN
#     - SYS_ADMIN
#     - SYS_RESOURCE
# cgroup:
#   autoMount:
#     enabled: false
#   hostRoot: /sys/fs/cgroup


hubble:
  peerService:
    clusterDomain: cluster.local
  relay:
    enabled: true
    affinity:
      nodeAffinity:
        requiredDuringSchedulingIgnoredDuringExecution:
          nodeSelectorTerms:
          - matchExpressions:
            - key: node-role.kubernetes.io/control-plane
              operator: DoesNotExist
            - key: kubernetes.io/arch
              operator: In
              values: 
              - 'amd64'
  ui:
    enabled: true
    affinity:
      nodeAffinity:
        requiredDuringSchedulingIgnoredDuringExecution:
          nodeSelectorTerms:
          - matchExpressions:
            - key: node-role.kubernetes.io/control-plane
              operator: DoesNotExist
            - key: kubernetes.io/arch
              operator: In
              values: 
              - 'amd64'


gatewayAPI:
  enabled: true
  secretsNamespace:
    create: false
    name: cilium
    sync: true


operator:
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
        - matchExpressions:
          - key: node-role.kubernetes.io/control-plane
            operator: DoesNotExist
          - key: kubernetes.io/arch
            operator: In
            values: 
            - 'amd64'