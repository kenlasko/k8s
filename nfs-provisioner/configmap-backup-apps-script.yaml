apiVersion: v1
kind: ConfigMap
metadata:
  name: backup-apps-script
  namespace: nfs-provisioner
data:
  backup-apps.sh: |
    #!/bin/ash
    ####################################
    # Backup apps to NFS mount script.
    ####################################  
  
    # Create archive filename.
    day=$(date +%A)
    archive_file="nas-backup-$day.tgz"
        
    # Print start status message.
    echo "Backing up vol to backup/vol/backup-$day.tgz"
    date
    echo
        
    tar --exclude 'data/vol/esphome/.esphome' --exclude 'data/vol/registry' --exclude 'data/vol/homeassist/.git' --exclude 'data/vol/homeassist/.storage' --exclude 'data/pxeboot/os-images' -czvf /backup/vol/backup-$day.tgz /data/vol /data/pxeboot

    # echo
    # echo
    # echo "Backing up pv to backup/pv/backup-$day.tgz"
    # date
    # echo
        
    # tar --exclude 'data/pv/media*' --exclude 'data/pv/monitoring*' -czvf /backup/pv/backup-$day.tgz /data/pv

    # Print end status message.
    echo
    echo "Backup finished"
    date