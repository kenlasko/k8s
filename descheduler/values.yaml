schedule: "*/30 * * * *"  # Every 15 minutes
priorityClassName: high-priority
deschedulerPolicy:
  profiles:
  - name: default
    pluginConfig:
    - name : DefaultEvictor
      args:
        ignorePvcPods: true
        evictLocalStoragePods: true
    - name: RemoveDuplicates
    - name: RemovePodsHavingTooManyRestarts
      args:
        podRestartThreshold: 10
        includingInitContainers: true
    - name: RemovePodsViolatingNodeTaints
      # args:
      #   nodeAffinityType:
      #     - requiredDuringSchedulingIgnoredDuringExecution
    - name: RemovePodsViolatingNodeAffinity
      # args:
      #   nodeAffinityType:
      #   - requiredDuringSchedulingIgnoredDuringExecution
    - name: RemovePodsViolatingInterPodAntiAffinity
    - name: RemovePodsViolatingTopologySpreadConstraint
      # args:
      #   includeSoftConstraints: false
    - name: LowNodeUtilization
      args:
        priorityThreshold:
          name: "medium-priority"
        nodeResourceUtilizationThresholds:
          thresholds:
            cpu: 100
            memory: 100
            pods: 25
          targetThresholds:
            cpu: 100
            memory: 100
            pods: 35
          namespaces:
            include:
            - 'adguard'
            - 'argocd'
            - 'cloudflare'
            - 'external-dns'
            - 'falco'
            - 'gitea'
            - 'headlamp'
            - 'monitoring'
            - 'media-tools'
            - 'portainer'
            - 'registry'
            - 'ucdialplans'
            - 'vaultwarden' 
  
affinity:
  nodeAffinity:
    requiredDuringSchedulingIgnoredDuringExecution:
      nodeSelectorTerms:
      - matchExpressions:
        - key: node-role.kubernetes.io/control-plane
          operator: DoesNotExist
        - key: kubernetes.io/arch
          operator: In
          values: 
          - 'amd64'