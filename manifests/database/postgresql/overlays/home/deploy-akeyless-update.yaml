apiVersion: batch/v1
kind: CronJob
metadata:
  name: update-akeyless
  namespace: postgresql
spec:
  schedule: "0 4 * * *"  # runs at 4am UTC daily
  jobTemplate:
    spec:
      template:
        metadata:
          labels:
            app: update-akeyless
        spec:
          serviceAccountName: akeyless-cli
          restartPolicy: OnFailure
          containers:
          - name: update-akeyless
            image: docker.io/kenlasko/akeyless-kubectl-cli:1.0
            command: ["/entrypoint.sh"]
            args: ["/scripts/update-cloud-certs.sh"]
            envFrom:
            - secretRef:
                name: akeyless-creds
            volumeMounts:
            - name: update-akeyless-script
              mountPath: /scripts/update-cloud-certs.sh
              subPath: update-cloud-certs.sh
          volumes:
          - name: update-akeyless-script
            configMap:
              name: update-akeyless-script
              items:
              - key: update-cloud-certs.sh
                path: update-cloud-certs.sh
