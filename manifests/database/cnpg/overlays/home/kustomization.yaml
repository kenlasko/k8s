apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: cnpg
helmCharts:
- name: cloudnative-pg
  repo: https://cloudnative-pg.github.io/charts
  version: 0.26.0
  releaseName: postgresql
  namespace: cnpg
  valuesFile: ../../base/values.yaml

resources:
- ../../base
- backup.yaml
- cluster.yaml
- cluster-standby.yaml
- cronjob-akeyless-update.yaml
- external-secrets.yaml
- service.yaml
- serviceaccount.yaml
- volume.yaml

configMapGenerator:
- name: update-akeyless-script
  files:
  - ../../scripts/update-cloud-certs.sh
  options:
    disableNameSuffixHash: true

# Only enable this patch when restoring from backup
# patches:
# - target:
#     group: ""
#     version: v1
#     kind: Cluster
#     name: home
#   path: patch-recovery.yaml