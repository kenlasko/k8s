---
apiVersion: batch/v1
kind: CronJob
metadata:
  name: dxp-envtenantnoactivity-ntt
  namespace: nectar-ps
spec:
  schedule: "0 0 * * *"  # daily at midnight
  suspend: false
  successfulJobsHistoryLimit: 1
  concurrencyPolicy: Replace
  jobTemplate:
    spec:
      template:
        spec:
          restartPolicy: OnFailure
          containers:
          - name: dxp-envtenantnoactivity-ntt
            image: quay.io/nectar-corp/nectar-ps:dxp-base-image
            imagePullPolicy: Always
            args: ["pwsh","Alert-DXPTenantNoActivity.ps1"]
            securityContext:
              allowPrivilegeEscalation: false
              readOnlyRootFilesystem: false
              runAsNonRoot: true
              runAsUser: 1000
              capabilities:
                drop:
                - all
            env:
            - name: DXPEnvName
              value: "ntt.eu.nectar.services"
            - name: DXPXMLCred
              value: "ntt-dxpcreds.xml"
            - name: DXPEmailFrom
              value: "***REMOVED***"
            - name: DXPEmailToList
              value: "don.clough@global.ntt,guga.ferreira@global.ntt,jean.turgeon@global.ntt,kevin.oelofsen@global.ntt,lionel.gaiero@global.ntt,ollie.clapinson@global.ntt,richard.seamarks@global.ntt,rowland.searle@global.ntt,jcross@nectarcorp.com"
            - name: DXPEmailCCList
              value: "***REMOVED***"
            - name: SendgridAPIKey
              valueFrom:
                secretKeyRef:
                  name: sendgrid
                  key: apikey
            volumeMounts:
            - name: nectar-ps-creds
              mountPath: /etc/nectar-ps-creds
              readOnly: true
            - name: dxp-notenantactivity
              mountPath: /nectar-code/Alert-DXPTenantNoActivity.ps1
              subPath: Alert-DXPTenantNoActivity.ps1
          volumes:
          - name: nectar-ps-creds
            secret:
              secretName: nectar-ps-creds
              defaultMode: 0444
          - configMap:
              items:
              - key: Alert-DXPTenantNoActivity.ps1
                path: Alert-DXPTenantNoActivity.ps1
              name: dxp-notenantactivity
            name: dxp-notenantactivity